{layout="default_site:site/_layout" root_class="news"}

{if segment_2 == "" OR segment_2 ~ "/^P\d+/" OR segment_2 == config:reserved_category_word}
    <main class="h-feed">
        <header class="h-feed__header">
            {if segment_2 == config:reserved_category_word}
                {exp:channel:category_heading channel="news" disable="category_fields"}
                    <h1>
                        {category_name}
                        {if no_results}
                            Categoria não encontrada
                        {/if}
                    </h1>
                    {layout:set name="title"}{category_name}{/layout:set}

                    {if category_description}
                        <p>{category_description}</p>
                    {/if}
                {/exp:channel:category_heading}
            {if:else}
                <h1 class="h-feed__p-name">Últimas notícias</h1>

                {layout:set name="title"}Últimas notícias{/layout:set}
            {/if}
        </header>

        {exp:channel:entries channel="news" limit="10" disable="category_fields|member_data" status="not closed" paginate="inline"}
            {if no_results}
                <p>Não há publicações.</p>
            {/if}
            {if count == "1"}
                <section class="h-feed__list h-feed__list--news">
            {/if}
                    <article id="entry-{entry_id}" class="h-feed__h-entry h-entry">
                        <a
                            {if channel_short_name == "page" || page_uri}
                                href="{page_uri}"
                            {if:else}
                                href="https:/{relative_url}/{url_title}"
                            {/if}
                            class="h-entry__u-url"
                        >
                            <header class="h-entry__header">
                                <h3 class="h-entry__p-name p-name">{title}</h3>

                                <time class="dt-published" datetime="{entry_date format="{DATE_ISO8601}"}">
                                    {entry_date format="%d/%m/%Y"}

                                    <span class="dt-published__time">
                                        {entry_date format="%H:%i"}
                                    </span>
                                </time>

                                {if global:editorial-group}
                                    {categories limit="1" show_group="{global:editorial-group}"}
                                        <ul class="h-entry__p-category-list">
                                    {/categories}

                                        {categories show_group="{global:editorial-group}"}
                                            <li class="h-entry__p-category-item" {if color}style="background-color: {color};"{/if}>
                                                {category_name}
                                            </li>
                                        {/categories}

                                    {categories limit="1" show_group="{global:editorial-group}"}
                                        </ul>
                                    {/categories}
                                {/if}
                            </header>

                            {thumbnail}
                                <img
                                        width="260" height="200"
                                        src="{url:thumb--aside}"
                                        decoding="async" loading="lazy"
                                        class="h-entry__u-photo h-entry__u-photo--last-news u-photo"
                                        alt="{description}"
                                />
                            {/thumbnail}

                            <div class="h-entry__p-summary">
                                {if summary}
                                    <p>{summary:limit characters="280" end_char="…"}</p>
                                {if:else}
                                    {body:limit characters="280" end_char="…"}
                                {/if}
                            </div>
                        </a>

                        <footer>
                            {tp-share_bar}
                        </footer>
                    </article>
            {if count == total_results}
                </section>
                {tp-pagination}
            {/if}
        {/exp:channel:entries}
    </main>
{if:elseif segment_2 AND segment_2 != config:reserved_category_word AND segment_3 == ""}

    {layout:set name="robots"}index,follow,noarchive,noodp{/layout:set}

    {exp:channel:entries channel="news" limit="1" require_entry="yes" show_future_entries="yes"
    disable="category_fields|member_data|pagination" status="not none"}
        {tp-check_draft}

        {layout:set name="title"}{title}{/layout:set}
        {layout:set name="description"}{summary:attr_safe limit="155"}{/layout:set}
        {layout:set name="entry_id"}{entry_id}{/layout:set}

        {layout:set name="canonical"}/{segment_1}/{url_title}{/layout:set}
        {thumbnail}
            {layout:set name="sharing_cover"}{url:facebook}{/layout:set}
        {/thumbnail}

        <article role="main" id="main" class="h-entry h-entry--news">
            <header class="h-entry__header">
                <h1 class="h-entry__p-name">{title}</h1>
                {if subhead}
                    <h2 class="h-entry__subhead">{subhead}</h2>
                {/if}
            </header>
            <div class="share-bar">
                {tp-share_bar}
            </div>

            <div class="read-more read-more--repository">
                <a href="/{segment_1}/{segment_2}/fotos" class="read-more__link">
                    Acessar fotos
                </a>
                <a href="/{segment_1}/{segment_2}/videos" class="read-more__link">
                    Acessar vídeos
                </a>
            </div>

            {hero}
                <figure class="hero">
                    <img
                        sizes="(max-width: 744px) 100vw, 744px"
                        srcset="
                            {url:300w} 300w,
                            {url:635w} 635w,
                            {url:744w} 744w"
                        src="{url:744w}"
                        decoding="async"
                        width="{width:744w}" height="{height:744w}"
                        alt="{description}"
                        class="hero__image"
                    />

                    {if title || credit || location}
                        <figcaption class="hero__caption">
                            {title}
                            {if location}
                                <small class="caption__location">
                                    ({location}{if credit} &mdash; {if:else}){/if}
                                </small>
                            {/if}
                            {if credit}
                                <small class="caption__credit">
                                    {if !location}({/if}{credit})
                                </small>
                            {/if}
                        </figcaption>
                    {/if}
                </figure>
            {/hero}

            {if body}
                <section class="h-entry__e-content e-content">{body}</section>
            {/if}

            <div class="slider" data-js="slider">
                <button type="button" class="js_prev slider__prev" aria-hidden="true">
                    &#9664;
                </button>
                <div class="slider__frame">
                    {tp-gallery}
                </div>
                <button type="button" class="js_next slider__next" aria-hidden="true">
                    &#9654;
                </button>
            </div>

        </article>
    {/exp:channel:entries}

{if:elseif segment_2 != config:reserved_category_word AND segment_3 == "imagens"}

    {exp:channel:entries channel="news" limit="1" require_entry="yes" show_future_entries="yes"
    disable="category_fields|member_data|pagination" status="not none" parse="inward"}
        {tp-check_draft}

        {layout:set name="title"}{title}{/layout:set}
        {layout:set name="description"}{summary:attr_safe limit="155"}{/layout:set}
        {layout:set name="entry_id"}{entry_id}{/layout:set}

        {layout:set name="canonical"}/{segment_1}/{url_title}{/layout:set}
        {thumbnail}
            {layout:set name="sharing_cover"}{url:facebook}{/layout:set}
        {/thumbnail}

        <article role="main" id="entry-{entry_id}" class="h-entry h-entry--repository">
            <header class="h-entry__header">
                <h3 class="h-entry__p-name p-name">{title}</h3>
            </header>

            <div class="h-entry__p-summary">
                {if summary}
                    <p>{summary:limit characters="280" end_char="…"}</p>
                {if:else}
                    {body:limit characters="280" end_char="…"}
                {/if}
            </div>

            <p class="read-more read-more--repository">
                <a
                    {if channel_short_name == "page" || page_uri}
                        href="{page_uri}"
                    {if:else}
                        href="https:/{relative_url}/{url_title}"
                    {/if}
                    class="h-entry__u-url h-entry__u-url read-more__link"
                >
                    Acessar notícia
                </a>
            </p>

            <div class="full-width">
                <div class="h-entry__e-content e-content e-content--repository container">
                    {hero}
                        <figure class="hero">
                            <img
                                sizes="(max-width: 744px) 100vw, 744px"
                                srcset="
                                    {url:300w} 300w,
                                    {url:635w} 635w,
                                    {url:744w} 744w"
                                src="{url:744w}"
                                decoding="async"
                                width="{width:744w}" height="{height:744w}"
                                alt="{description}"
                                class="hero__image"
                            />

                            {if title || credit || location}
                                <figcaption class="hero__caption">
                                    {title}
                                    {if location}
                                        <small class="caption__location">
                                            ({location}{if credit} &mdash; {if:else}){/if}
                                        </small>
                                    {/if}
                                    {if credit}
                                        <small class="caption__credit">
                                            {if !location}({/if}{credit})
                                        </small>
                                    {/if}
                                </figcaption>
                            {/if}
                        </figure>
                    {/hero}

                    <div class="share-bar">
                        Compartilhe:
                        {tp-share_bar}
                    </div>

                    {if gallery:total_rows}
                        <p class="read-more read-more--download">
                            <a
                                href="/{segment_1}/{url_title}/download"
                                class="read-more__link"
                            >
                                Download
                            </a>
                        </p>
                    {/if}

                    <div class="slider" data-js="slider">
                        <button type="button" hidden class="js_prev slider__prev" aria-hidden="true">
                            &#9664;
                        </button>
                        <div class="slider__frame">
                            {tp-gallery}
                        </div>
                        <button type="button" hidden class="js_next slider__next" aria-hidden="true">
                            &#9654;
                        </button>
                    </div>
                </div>
            </div>
        </article>
    {/exp:channel:entries}

{if:elseif segment_2 != config:reserved_category_word AND segment_3 == "videos"}

{if:elseif segment_2 != config:reserved_category_word AND segment_3 == "download"}
    {exp:channel:entries channel="news" limit="1" require_entry="yes" show_future_entries="yes"
    disable="categories|category_fields|member_data|pagination" status="not none" parse="inward"}
        {tp-check_draft}

        {if gallery:total_rows}
            {exp:zip filename="{url_title}-{entry_id}.zip" direct_output="yes" max_size="1024"
            folder="../system/user/zip_cache"}
                {zip:files}
                    {gallery}
                        [{gallery:file}]
                    {gallery}
                {/zip:files}
            {/exp:zip}
        {if:else}
            {redirect="404"}
        {/if}

    {/exp:channel:entries}
{if:else}
    {redirect="404"}
{/if}
