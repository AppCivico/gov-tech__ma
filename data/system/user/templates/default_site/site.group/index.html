{layout="default_site:site/_layout" root_class="home" robots="index,follow,noarchive"}

<main id="main" class="home__main">
    <section class="main-services h-feed h-feed--main-services">
        <h2 class="p-name h-feed__p-name h-feed__p-name--main-services">Principais serviços</h2>

        {exp:query
        sql="SELECT ec.cat_id, ec.cat_name, COUNT(ecp.entry_id) AS total_entries
            FROM exp_categories ec
            JOIN exp_category_groups cg ON ec.group_id = cg.group_id
            JOIN exp_category_posts ecp ON ecp.cat_id = ec.cat_id
            JOIN exp_channel_titles ect ON ecp.entry_id = ect.entry_id
            JOIN exp_channels ec2 ON ect.channel_id = ec2.channel_id
            WHERE ec2.channel_name = 'service'
                AND LOWER(cg.group_name) = 'perfil do cidadao'
                AND ect.status = 'open'
            GROUP BY ec.cat_url_title
            ORDER BY COUNT(ecp.entry_id) DESC
            LIMIT 4"
            parse="inward"
        }
            <div class="main-services__category">
                <h3 class="main-services__title">{cat_name}</h3>
                <ul class="main-services__list">
                {exp:channel:entries channel="service" site="not 0" category="{cat_id}"
                disable="custom_fields|categories|category_fields|member_data|pagination" status="open" limit="5"}
                    <li class="main-services__item">
                        <a href="https://{relative_url}/{url_title}">{title}</a>
                    </li>
                {/exp:channel:entries}
                </ul>
            </div>
        {/exp:query}
    </section>

    {exp:channel:entries channel="news" limit="4" disable="categories|category_fields|member_data|pagination" status="not closed"}
        {if count == 1}
        <section class="last-news h-feed">
            <h2 class="last-news__title h-feed__p-name p-name">Últimas notícias</h2>
            <div class="h-feed__list h-feed__list--last-news">
        {/if}
                <a
                    href='https://{relative_url}/{url_title}'
                    class="last-news__link h-entry__u-url"
                >
                    <article id="entry-{entry_id}" class="h-feed__h-entry h-entry last-news__item">
                        {if count == 1}
                            {thumbnail}
                                <img
                                sizes="(max-width: 544px) 100vw, 544px"

                                data-width="554" data-height="512"
                                width="{width:featured__square--large}" height="{height:featured__square--large}"
                                src="{url:featured__square--large}"
                                decoding="async" loading="lazy"
                                class="h-entry__u-photo u-photo last-news__item-thumb"
                                alt="{description}"
                            />
                            {/thumbnail}
                        {if:elseif count == 2}
                            {thumbnail}
                                <img
                                    sizes="(max-width: 544px) 100vw, 544px"
                                    srcset="
                                        {url:featured__square--small} {width:featured__square--small}w,
                                        {url:featured__wide} {width:featured__wide}w
                                    "
                                    data-width="554" data-height="246"
                                    width="{width:featured__wide}" height="{height:featured__wide}"
                                    src="{url:featured__wide}"
                                    decoding="async" loading="lazy"
                                    class="h-entry__u-photo u-photo last-news__item-thumb"
                                    alt="{description}"
                                />
                            {/thumbnail}
                        {if:else}
                            {thumbnail}
                                <img
                                    data-width="246" data-height="246"
                                    width="{width:featured__square--small}" height="{height:featured__square--small}"
                                    src="{url:featured__square--small}"
                                    decoding="async" loading="lazy"
                                    class="h-entry__u-photo u-photo last-news__item-thumb"
                                    alt="{description}"
                                />
                            {/thumbnail}
                        {/if}
                        <h3 class="h-entry__p-name p-name last-news__item-title">{title}</h3>
                        <p class="h-entry__dt-published last-news__date">
                            <time class="dt-published" datetime="{edit_date format="{DATE_ISO8601}"}">
                                {edit_date format="%d de %F de %Y"}
                            </time>
                        </p>
                    </article>
                </a>

        {if count == total_results}
            </div>
        </section>
        {/if}
    {/exp:channel:entries}

</main>
